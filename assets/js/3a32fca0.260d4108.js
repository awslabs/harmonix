"use strict";(self.webpackChunk_aws_harmonix_on_aws_website=self.webpackChunk_aws_harmonix_on_aws_website||[]).push([[4618],{7367:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>s,default:()=>h,frontMatter:()=>r,metadata:()=>a,toc:()=>l});var o=t(4848),i=t(8453);const r={sidebar_position:5},s="Security",a={id:"techdocs/security",title:"Security",description:"Harmonix on AWS is built on the Backstage open source project and, thus, inherits the security considerations applicable to the platform.",source:"@site/docs/techdocs/security.md",sourceDirName:"techdocs",slug:"/techdocs/security",permalink:"/docs/techdocs/security",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:5,frontMatter:{sidebar_position:5},sidebar:"tutorialSidebar",previous:{title:"Cluster Access",permalink:"/docs/techdocs/runtimes/kubernetes/clusterAccess"},next:{title:"Permissions",permalink:"/docs/techdocs/permission"}},c={},l=[{value:"Authentication",id:"authentication",level:2},{value:"Organizational data",id:"organizational-data",level:2},{value:"AWS Security",id:"aws-security",level:2},{value:"Introduction",id:"introduction",level:3},{value:"Environments and access to AWS services",id:"environments-and-access-to-aws-services",level:3},{value:"Diving deep to access roles trust policy",id:"diving-deep-to-access-roles-trust-policy",level:3}];function d(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"security",children:"Security"})}),"\n",(0,o.jsx)(n.p,{children:"Harmonix on AWS is built on the Backstage open source project and, thus, inherits the security considerations applicable to the platform."}),"\n",(0,o.jsx)(n.p,{children:"The sections below capture details about the Harmonix on AWS reference implementation to help you understand the out-of-the-box implementations related to security.  Many of the configurations can easily be changed to meet your specific access control needs."}),"\n",(0,o.jsx)(n.admonition,{type:"warning",children:(0,o.jsxs)(n.p,{children:["It is ",(0,o.jsx)(n.strong,{children:"strongly"})," recommended that you read the ",(0,o.jsx)(n.a,{href:"https://backstage.io/docs/overview/threat-model",children:"Backstage Threat Model"})," documentation to familiarize yourself with the trust model and integrator responsibilities to secure access."]})}),"\n",(0,o.jsx)(n.h2,{id:"authentication",children:"Authentication"}),"\n",(0,o.jsxs)(n.p,{children:["The ",(0,o.jsx)(n.a,{href:"https://backstage.io/docs/auth/",children:"Backstage Authentication system"})," provides for sign-in and identification of users.  The Harmonix on AWS reference implementation is pre-configured to use Okta as an authentication provider. This demonstrates one type of authentication provider; however, it can easily be changed to other common identity providers such as Active Directory and other OAuth 2 supported providers."]}),"\n",(0,o.jsx)(n.admonition,{type:"info",children:(0,o.jsxs)(n.p,{children:["Multiple providers are supported by Backstage. For the complete list, consult the ",(0,o.jsx)(n.a,{href:"https://backstage.io/docs/auth/",children:'Backstage "Included providers" documentation'})]})}),"\n",(0,o.jsx)(n.h2,{id:"organizational-data",children:"Organizational data"}),"\n",(0,o.jsxs)(n.p,{children:["Backstage provides support to map organizational data such as users and groups into entities in the Backstage catalog.  The Harmonix on AWS reference implementation is pre-configured to use the ",(0,o.jsx)(n.code,{children:"OktaOrgEntityProvider"})," from the ",(0,o.jsx)(n.a,{href:"https://www.npmjs.com/package/@roadiehq/catalog-backend-module-okta",children:"catalog-backend-module-okta plugin"})," from ",(0,o.jsx)(n.a,{href:"https://roadie.io",children:"Roadie"}),'.  This plugin will read Okta Users and Groups from a configured Okta instance and create entities in the catalog.  Once they are populated in the catalog, user and group entities can be used for creating relationships (e.g. "ownedBy") with other entities.  User and Group entities can also be used in the Backstage permission framework to enforce allow/deny policy decisions.']}),"\n",(0,o.jsxs)(n.p,{children:["Alternatives for organizational data ingestion can be configured for ",(0,o.jsx)(n.a,{href:"https://backstage.io/docs/integrations/ldap/org",children:"OpenLDAP"}),", ",(0,o.jsx)(n.a,{href:"https://backstage.io/docs/integrations/github/org",children:"GitHub"}),", ",(0,o.jsx)(n.a,{href:"https://backstage.io/docs/integrations/gitlab/org",children:"GitLab"}),", and more.  Consult the ",(0,o.jsx)(n.a,{href:"https://backstage.io/docs/integrations/",children:"Backstage Integrations documentation"})," and ",(0,o.jsx)(n.a,{href:"https://backstage.io/plugins/",children:"Backstage plugin directory"})," for additional options and details."]}),"\n",(0,o.jsx)(n.h2,{id:"aws-security",children:"AWS Security"}),"\n",(0,o.jsx)(n.h3,{id:"introduction",children:"Introduction"}),"\n",(0,o.jsx)(n.p,{children:"While there are different methodologies when it comes to security in the cloud, we adopted some of the approaches we have seen at our financial customers. These include:"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsx)(n.li,{children:"Segregation of access controls"}),"\n",(0,o.jsx)(n.li,{children:"Use of temporary credentials"}),"\n",(0,o.jsx)(n.li,{children:"Separation of duties and the least privileges principle"}),"\n",(0,o.jsx)(n.li,{children:"Use of different AWS accounts to ensure default restrictions"}),"\n",(0,o.jsx)(n.li,{children:"Separation of production/staging environments from development/sandbox environments"}),"\n"]}),"\n",(0,o.jsx)(n.admonition,{type:"note",children:(0,o.jsxs)(n.p,{children:["The above principles are not a replacement for organization-level preventive and detective controls. It is recommended to use services like ",(0,o.jsx)(n.a,{href:"https://aws.amazon.com/controltower/",children:"AWS Control Tower"})," and ",(0,o.jsx)(n.a,{href:"https://docs.aws.amazon.com/organizations/latest/userguide/orgs_manage_policies_scps.html",children:"Service Control Policies (SCPs)"})," to have multiple layers of security from the developer platform throughout the organization governance and controls."]})}),"\n",(0,o.jsx)(n.h3,{id:"environments-and-access-to-aws-services",children:"Environments and access to AWS services"}),"\n",(0,o.jsx)(n.p,{children:'We define an environment as a "place" in AWS. Granting access to an environment will allow a user or process to gain access only to the resources of that environment, but not to other environments.'}),"\n",(0,o.jsx)(n.p,{children:"Definition of AWS Environment Provider:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Include all of the supporting software artifacts to run a particular type of workload (Container-based, Serverless, AI/ML etc..)."}),"\n",(0,o.jsx)(n.li,{children:"Must reside within an AWS Account and a region."}),"\n",(0,o.jsx)(n.li,{children:"Must provide at least two roles to gain access to the environment resources: a Provisioning role and an Operations role."}),"\n",(0,o.jsx)(n.li,{children:"Mutually exclusive by design - One provider cannot access resources from another provider, even if they are configured to use the same AWS account and region."}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"There are several methods for a user to gain access to an environment:"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Indirect access"})," - throughout the developer platform and pipeline, a developer can perform actions on an allowed target environment. The platform/pipeline will assume the target environment roles and get temporary credentials to perform the actions on behalf of the user."]}),"\n"]}),"\n",(0,o.jsx)(n.mermaid,{value:'flowchart LR\n    user["User"]\n    platform["Platform"]\n    env((AWS Environment provider))\n    operations["Operations role"]\n    keys["Temporary credentials"]\n    user --\x3e platform --\x3e env --\x3e operations --\x3e keys --\x3e platform'}),"\n",(0,o.jsx)(n.mermaid,{value:'flowchart LR\n    user["User"]\n    pipeline["Pipeline runner"]\n    env((AWS Environment provider))\n    provisioning["Provisioning role"]\n    keys["Temporary credentials"]\n    user --\x3e pipeline --\x3e env --\x3e provisioning --\x3e keys --\x3e pipeline'}),"\n",(0,o.jsxs)(n.ol,{start:"2",children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Direct access"})," - a user can assume credentials directly to the target environment access roles (Provisioning roles, operations role)"]}),"\n"]}),"\n",(0,o.jsx)(n.mermaid,{value:'flowchart LR\n    user["User"]\n    env((AWS Environment provider))\n    provisioning["Provisioning/Operations role"]\n    keys["Temporary credentials"]\n    user --\x3e env --\x3e provisioning --\x3e keys --\x3e user'}),"\n",(0,o.jsxs)(n.ol,{start:"3",children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Resource specific access"})," - a user can assume access to a particular shared resource by the environment, such as: kubectl"]}),"\n"]}),"\n",(0,o.jsx)(n.mermaid,{value:'flowchart LR\n    user["User"]\n    env((AWS Environment provider))\n    kubectl["Kubectl service"]\n    keys["Temporary credentials"]\n    user --\x3e env --\x3e kubectl --\x3e keys --\x3e user'}),"\n",(0,o.jsx)(n.admonition,{type:"info",children:(0,o.jsx)(n.p,{children:"Environment provider authors can reason about the required set of permissions for provisioning and operating applications for this environment. Harmonix on AWS provides sample templates for Amazon ECS, Amazon EKS, and Serverless environment providers."})}),"\n",(0,o.jsx)(n.h3,{id:"diving-deep-to-access-roles-trust-policy",children:"Diving deep to access roles trust policy"}),"\n",(0,o.jsxs)(n.p,{children:["As described above, Harmonix on AWS provides a pattern of assuming access to particular AWS environments. Out of the box, when provisioning a new environment provider, the ",(0,o.jsx)(n.em,{children:"provisioning role"})," and ",(0,o.jsx)(n.em,{children:"operations role"})," are created and their trust policy is modified to enable the platform role and pipeline role respectively."]}),"\n",(0,o.jsxs)(n.p,{children:["example of: commercial-us-commercial-dev-",(0,o.jsx)(n.strong,{children:"provisioning-role"})," - Assumed by gitlab pipeline role"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-json",children:'{\n    "Version": "2012-10-17",\n    "Statement": [\n        {\n            "Effect": "Allow",\n            "Principal": {\n                "AWS": "arn:aws:iam::123456789012:role/opa-platform-GitlabRunnerConstructGitlabRunnerIamR"\n            },\n            "Action": "sts:AssumeRole"\n        }\n    ]\n}\n'})}),"\n",(0,o.jsxs)(n.p,{children:["example of: commercial-us-commercial-dev-",(0,o.jsx)(n.strong,{children:"operations-role"})," - Assumed by the platform role"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-json",children:'{\n    "Version": "2012-10-17",\n    "Statement": [\n        {\n            "Effect": "Allow",\n            "Principal": {\n                "AWS": "arn:aws:iam::123456789012:role/backstage-master-role"\n            },\n            "Action": "sts:AssumeRole"\n        }\n    ]\n}\n'})}),"\n",(0,o.jsx)(n.admonition,{type:"tip",children:(0,o.jsxs)(n.p,{children:["You can also configure these roles with federation to grant access to your users based on their membership in certain group that is set up for your identity provider. This can be done with SAML or WebIdentity - for more information, ",(0,o.jsx)(n.a,{href:"https://aws.amazon.com/blogs/security/how-to-use-trust-policies-with-iam-roles/",children:"read here"}),"."]})})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>s,x:()=>a});var o=t(6540);const i={},r=o.createContext(i);function s(e){const n=o.useContext(r);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:s(e.components),o.createElement(r.Provider,{value:n},e.children)}}}]);