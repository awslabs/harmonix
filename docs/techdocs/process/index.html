<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-techdocs/process" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">Processes | Harmonix on AWS</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://harmonixonaws.io/img/harmonix-blue.png"><meta data-rh="true" name="twitter:image" content="https://harmonixonaws.io/img/harmonix-blue.png"><meta data-rh="true" property="og:url" content="https://harmonixonaws.io/docs/techdocs/process"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Processes | Harmonix on AWS"><meta data-rh="true" name="description" content="Deploying a template"><meta data-rh="true" property="og:description" content="Deploying a template"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://harmonixonaws.io/docs/techdocs/process"><link data-rh="true" rel="alternate" href="https://harmonixonaws.io/docs/techdocs/process" hreflang="en"><link data-rh="true" rel="alternate" href="https://harmonixonaws.io/docs/techdocs/process" hreflang="x-default"><link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-K11BYW5K62"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-K11BYW5K62",{anonymize_ip:!0})</script><link rel="stylesheet" href="/assets/css/styles.ca8ae2d6.css">
<script src="/assets/js/runtime~main.be82a26a.js" defer="defer"></script>
<script src="/assets/js/main.192b2ec5.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const a=new URLSearchParams(window.location.search).entries();for(var[t,e]of a)if(t.startsWith("docusaurus-data-")){var n=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(n,e)}}catch(t){}}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="announcementBar_mb4j" style="background-color:#ffffff;color:#000000" role="banner"><div class="announcementBarPlaceholder_vyr4"></div><div class="content_knG7 announcementBarContent_xLdY">Harmonix on AWS 0.3.4 is now available.  Check it out and give it a star on <a target="_blank" rel="noopener noreferrer" href="https://github.com/awslabs/harmonix">GitHub</a>! ⭐️.  View changes <a target="_blank" rel="noopener noreferrer" href="https://harmonixonaws.io/docs/CHANGELOG">here</a>.</div><button type="button" aria-label="Close" class="clean-btn close closeButton_CVFx announcementBarClose_gvF7"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/harmonix-white.svg" alt="Harmonix on AWS Logo" class="harmonix-nav-logo themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/harmonix-white.svg" alt="Harmonix on AWS Logo" class="harmonix-nav-logo themedComponent_mlkZ themedComponent--dark_xIcU"></div></a><a class="navbar__item navbar__link" href="/docs/getting-started/deploy-the-platform">Getting Started</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/intro">Documentation</a><a class="navbar__item navbar__link" href="/workshop">Workshop</a><a class="navbar__item navbar__link" href="/partners">Partners</a><a class="navbar__item navbar__link" href="/about">About</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/awslabs/harmonix" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="Github repository"></a><div class="navbarSearchContainer_Bca1"><div class="navbar__search"><span aria-label="expand searchbar" role="button" class="search-icon" tabindex="0"></span><input id="search_input_react" type="search" placeholder="Loading..." aria-label="Search" class="navbar__search-input search-bar" disabled=""></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG menuWithAnnouncementBar_GW3s"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/intro">Intro</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/getting-started">Getting Started</a><button aria-label="Expand sidebar category &#x27;Getting Started&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/tutorials">Tutorials</a><button aria-label="Expand sidebar category &#x27;Tutorials&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/docs/category/tech-docs">Tech Docs</a><button aria-label="Collapse sidebar category &#x27;Tech Docs&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/techdocs/architecture">Architecture</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/techdocs/entities">Entities</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/techdocs/plugins">Plugins</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/techdocs/process">Processes</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/category/environment-runtimes">Environment Runtimes</a><button aria-label="Expand sidebar category &#x27;Environment Runtimes&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/techdocs/security">Security</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/techdocs/permission">Permissions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/techdocs/customizations">Customizations</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed hidden"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/diy">DIY</a><button aria-label="Expand sidebar category &#x27;DIY&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/integration">Integration</a><button aria-label="Expand sidebar category &#x27;Integration&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/migrations">Migrations</a><button aria-label="Expand sidebar category &#x27;Migrations&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/features">Features</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/faq">FAQ</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/tests">Test Cases</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/CONTRIBUTING">CONTRIBUTING</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/CHANGELOG">Changelog</a></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/tech-docs"><span itemprop="name">Tech Docs</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Processes</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Processes</h1></header>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="deploying-a-template">Deploying a template<a href="#deploying-a-template" class="hash-link" aria-label="Direct link to Deploying a template" title="Direct link to Deploying a template">​</a></h2>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>The process described below is true for all templates with the exception of AWS Environment.</p></div></div>
<p>When a user selects a template in the catalog and clicks <em>Create</em>, the below process is initiated.</p>
<!-- -->
<ol>
<li><strong>Template Creation</strong>: The process of filling the template with the required input from the user, text fields, selecting other entities, choosing options etc.</li>
<li><strong>Rendered Entity Data</strong>: Based on the previous selection, this process will fetch all the required data before populating the repository. This includes information about the selected environment entity, platform configurations and entity rendered data. You can see the result of this process in the generated repository right after creation. This process make use of the Scaffolder actions plugin.</li>
<li><strong>Create Repository</strong>: Create the git repository for the entity, code, IaC and environment information. Based on the type of template, the repository will be created in a git project group: environments, environment-providers, aws-app, aws-resources. This allows us to segregate access control from managing repositories under different security domains.</li>
<li><strong>Store initial files and pipeline</strong>: Persisting the generated files from step 2 in the repository including the particular pipeline pattern that fits the selected template (See below for more details on pipeline process).</li>
<li><strong>Pipeline execution</strong>: Using Gitlab runner executing the pipeline in a separate shell. For building container images, we use Docker in Docker with Paketo build packs or Kaniko</li>
<li><strong>Get Credentials</strong>: Fetch credentials from the target (Environment provider) provisioning role in order to provision the IAC for the template.</li>
<li><strong>Provision IaC</strong>: Provision the IaC against the target destination (Environment provider) - cdk deploy / terraform apply</li>
<li><strong>Update Entity catalog</strong>: Based on step 7 select the desired IaC deployment output and update the entity catalog file (<em>catalog-info.yaml</em>) with the resources information.</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="executing-gitlab-pipeline">Executing Gitlab pipeline<a href="#executing-gitlab-pipeline" class="hash-link" aria-label="Direct link to Executing Gitlab pipeline" title="Direct link to Executing Gitlab pipeline">​</a></h2>
<p>The pipeline execution process is composed of several patterns and abstractions. This was done for several reasons, but mostly for reusability and security controls.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="abstracted-centralized-pipelines">Abstracted centralized pipelines<a href="#abstracted-centralized-pipelines" class="hash-link" aria-label="Direct link to Abstracted centralized pipelines" title="Direct link to Abstracted centralized pipelines">​</a></h3>
<p>In order to allow updates and changes for pipelines that may be enforced by the platform engineering team, we externalized some of the pipeline actions and provide only the necessary variables as an input.</p>
<div class="language-pipeline codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">.gitlab-ci.yml</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-pipeline codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">stages:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - env-creation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - prepare-dev-stage</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - dev-stage</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">variables:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  APP_SHORT_NAME: &quot;my-app&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  APP_TEMPLATE_NAME: &quot;example-nodejs&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  OPA_PLATFORM_REGION: &quot;us-east-1&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">include:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - project: &#x27;opa-admin/backstage-reference&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ref: main </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    file:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - &#x27;common/cicd/.gitlab-ci-job-defaults-cdk.yml&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - &#x27;common/cicd/.gitlab-ci-aws-base.yml&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - &#x27;common/cicd/.gitlab-ci-aws-iac-ecs.yml&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - &#x27;common/cicd/.gitlab-ci-aws-image-kaniko.yml&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The first part of our pipeline, &quot;<em>stages</em>&quot;, defines the stages of this pipeline for the current state. This part is not fixed, we may introduce more stages when our application will be deployed to additional environments. Nonetheless we can see the first two stages for our dev environment:</p>
<ol>
<li><em>prepare-dev-stage</em> - this stage provisions and prepares the environment to be able to run the application before we start making continuous code changes to our repositories.</li>
<li><em>dev-stage</em> - this stage is responsible for compiling, building and deploying new versions of our application each time we push new code changes to our application logic (/src directory)</li>
</ol>
<p>The <em>env-creation</em> is the stage to create the two stages above, the reason this is a stage on it&#x27;s own is because we can reuse it to create more stages later, when the application is deployed to other environments.</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>The <em>include</em> clause allows us to dynamically pull pipelines from another repository each time the pipeline will run.</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="modular-pipelines">Modular pipelines<a href="#modular-pipelines" class="hash-link" aria-label="Direct link to Modular pipelines" title="Direct link to Modular pipelines">​</a></h3>
<p>The idea of modular pipelines is to include smaller pipelines that contain jobs which together can provide a building block for different pipeline orchestrations. You may have already noticed from the example above we use several include statements. These statements help to reuse similar functionally for different templates / application patterns.</p>
<p>The complete list of pipeline patterns is available at: <a href="https://github.com/awslabs/harmonix/tree/main/backstage-reference/common/cicd" target="_blank" rel="noopener noreferrer">CICD Directory</a></p>
<ol>
<li>.gitlab-ci-aws-base.yml</li>
<li>.gitlab-ci-aws-dind-spring-boot.yml</li>
<li>.gitlab-ci-aws-iac-ecs.yml</li>
<li>.gitlab-ci-aws-iac-rds.yml</li>
<li>.gitlab-ci-aws-iac-serverless-api.yml</li>
<li>.gitlab-ci-aws-iac-tf-ecs.yml</li>
<li>.gitlab-ci-aws-image-kaniko.yml</li>
<li>.gitlab-ci-aws-provider-ecs.yml</li>
<li>.gitlab-ci-aws-provider-serverless.yml</li>
<li>.gitlab-ci-aws-tf-base.yml</li>
<li>.gitlab-ci-job-defaults-cdk.yml</li>
<li>.gitlab-ci-job-defaults-tf.yml</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="pipeline-jobs">Pipeline jobs<a href="#pipeline-jobs" class="hash-link" aria-label="Direct link to Pipeline jobs" title="Direct link to Pipeline jobs">​</a></h3>
<p>There are several jobs imported into the pipeline based on the pattern you use. Below is an example of pipeline executions and the job for each one of them:</p>
<p align="center"></p><p><img decoding="async" loading="lazy" alt="pipeline1.png" src="/assets/images/pipeline1-1c26339d695f24b943dfc418e13a0250.png" width="1596" height="492" class="img_ev3q"></p><p></p>
<ol>
<li><strong>Initial commit</strong>
<ol>
<li>create-ci-stages - The job creates new stages for a target environment with its providers.</li>
</ol>
</li>
<li><strong>Added CICD environment stage</strong>
<ol>
<li>iac-deployment-ENVXXX-ProviderYYY - the job provision IAC against the target environment/provider</li>
<li>get-aws-creds-ENVXXX-ProviderYYY - the job gets credentials from the provisioning role of the target provider</li>
<li>build-image-ENVXXX-ProviderYYY - the job build a new image from the /src directory and update the container image</li>
<li>delete-aws-creds-ENVXXX-ProviderYYY - delete the temporary credentials so that they are not persisted in the repository</li>
</ol>
</li>
<li><strong>updating entity details</strong> - update cataloginfo.yaml with the IaC metadata. There is no need to run the pipeline again after this update, which is why the pipeline is showing as &quot;Skipped&quot;.</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="deploy-an-application-to-another-environment">Deploy an application to another environment<a href="#deploy-an-application-to-another-environment" class="hash-link" aria-label="Direct link to Deploy an application to another environment" title="Direct link to Deploy an application to another environment">​</a></h2>
<p>The process of deploying an application to another environment works by utilizing the jobs and stage we describe above. To visualize how the git pipeline looks when performing a multi-environment deployment, let&#x27;s look at the below diagram.</p>
<p align="center"></p><p><img decoding="async" loading="lazy" alt="pipeline2.png" src="/assets/images/pipeline2-546c7b41023040f57cf73a8d9080852f.png" width="1670" height="1158" class="img_ev3q"></p><p></p>
<p>We can see that once we deploy an application to another environment we essentially created new stages for the new target environment.</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>The process to deploy an application to another environment is done by submitting a commit to git with a specific message <strong>generate CICD stages</strong> along with a properties file that contains the information of the new target environment. When the pipeline job runs, it will process the new file and create corresponding stages for the new target destination. This change will automatically execute the pipeline and stage to deploy the application to the new target environment.</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="continuous-deployment-for-app-code">Continuous deployment for app code<a href="#continuous-deployment-for-app-code" class="hash-link" aria-label="Direct link to Continuous deployment for app code" title="Direct link to Continuous deployment for app code">​</a></h3>
<p>How do the application logic code changes propagate to multiple environments?
For example - if we have the below pattern of commit on our repository - every time we merge changes to the main branch /src directory (Can be configured differently) the ENV-XXX-stage will be triggered.</p>
<br>
<p>If we have several stages for multiple environments, all of them will be triggered in the original order they were created in.</p>
<!-- -->
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>If we configured the environment with <em>&quot;Requires approval&quot;</em>, the pipeline that pushes code changes will halt until an approval is granted. This is useful in cases where we want supervision of what changes are propagated to a sensitive environment. Additional security controls can also be implemented.</p></div></div></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/techdocs/plugins"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Plugins</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/category/environment-runtimes"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Environment Runtimes</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#deploying-a-template" class="table-of-contents__link toc-highlight">Deploying a template</a></li><li><a href="#executing-gitlab-pipeline" class="table-of-contents__link toc-highlight">Executing Gitlab pipeline</a><ul><li><a href="#abstracted-centralized-pipelines" class="table-of-contents__link toc-highlight">Abstracted centralized pipelines</a></li><li><a href="#modular-pipelines" class="table-of-contents__link toc-highlight">Modular pipelines</a></li><li><a href="#pipeline-jobs" class="table-of-contents__link toc-highlight">Pipeline jobs</a></li></ul></li><li><a href="#deploy-an-application-to-another-environment" class="table-of-contents__link toc-highlight">Deploy an application to another environment</a><ul><li><a href="#continuous-deployment-for-app-code" class="table-of-contents__link toc-highlight">Continuous deployment for app code</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/getting-started/deploy-the-platform">Getting Started</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/intro">Tutorial</a></li></ul></div><div class="col footer__col"><div class="footer__title">Learn</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://harmonixonaws.io/docs/getting-started/videos" target="_blank" rel="noopener noreferrer" class="footer__link-item">Video Tutorials<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/awslabs/harmonix" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Built with ❤️ at AWS | Copyright © 2025 Amazon.com, Inc. or its affiliates. All rights reserved</div></div></div></footer></div>
</body>
</html>